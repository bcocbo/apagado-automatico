# Security Configuration for Namespace Auto-Shutdown System
# This file defines security policies, thresholds, and scanning configurations

# Vulnerability scanning thresholds
vulnerability_thresholds:
  critical: 0      # No critical vulnerabilities allowed
  high: 5          # Maximum 5 high severity vulnerabilities
  medium: 20       # Maximum 20 medium severity vulnerabilities
  low: 50          # Maximum 50 low severity vulnerabilities

# Secret scanning configuration
secret_scanning:
  enabled: true
  fail_on_detection: true
  patterns:
    - "password"
    - "secret"
    - "token"
    - "api_key"
    - "private_key"
    - "aws_access_key"
    - "aws_secret_key"

# Container security policies
container_security:
  # Base image policies
  allowed_base_images:
    - "python:3.11-slim"
    - "node:18-alpine"
    - "nginx:alpine"
    - "scratch"
  
  # Security requirements
  require_non_root: true
  require_read_only_root: false  # Optional but recommended
  require_security_context: true
  
  # Resource limits
  require_resource_limits: true
  max_memory: "1Gi"
  max_cpu: "1000m"

# Code analysis configuration
code_analysis:
  # Languages to analyze
  languages:
    - python
    - javascript
    - typescript
    - yaml
    - dockerfile
  
  # Security frameworks to check against
  security_frameworks:
    - owasp-top-10
    - cwe-top-25
    - sans-top-25
  
  # Custom rules
  custom_rules:
    - no_hardcoded_secrets
    - secure_random_generation
    - input_validation
    - sql_injection_prevention
    - xss_prevention

# Dependency scanning
dependency_scanning:
  # Package managers to scan
  package_managers:
    - pip
    - npm
    - yarn
  
  # Vulnerability databases
  databases:
    - nvd
    - github_advisory
    - pyup
    - snyk
  
  # License compliance
  allowed_licenses:
    - MIT
    - Apache-2.0
    - BSD-3-Clause
    - ISC
    - GPL-3.0
  
  forbidden_licenses:
    - GPL-2.0
    - AGPL-3.0

# Infrastructure as Code (IaC) scanning
iac_scanning:
  enabled: true
  frameworks:
    - kubernetes
    - docker
    - terraform
    - cloudformation
  
  # Kubernetes security policies
  kubernetes_policies:
    - no_privileged_containers
    - require_security_context
    - require_resource_limits
    - no_host_network
    - no_host_pid
    - require_non_root
    - require_read_only_root_filesystem

# Compliance frameworks
compliance:
  frameworks:
    - cis-kubernetes
    - nist-800-53
    - pci-dss
    - sox
  
  # Required security controls
  required_controls:
    - access_control
    - audit_logging
    - encryption_at_rest
    - encryption_in_transit
    - vulnerability_management

# Notification settings
notifications:
  # Channels for security alerts
  channels:
    - github_security_tab
    - slack
    - email
  
  # Severity levels that trigger notifications
  notify_on:
    - critical
    - high
  
  # Escalation rules
  escalation:
    critical:
      immediate: true
      channels: ["slack", "email"]
    high:
      delay: "15m"
      channels: ["slack"]
    medium:
      delay: "1h"
      channels: ["github_security_tab"]

# Remediation policies
remediation:
  # Auto-fix policies
  auto_fix:
    enabled: true
    severity_threshold: "medium"
    create_pr: true
  
  # SLA for manual fixes
  sla:
    critical: "24h"
    high: "7d"
    medium: "30d"
    low: "90d"

# Exemptions and exceptions
exemptions:
  # Temporary exemptions (with expiration)
  temporary:
    - cve: "CVE-2023-12345"
      reason: "No fix available, mitigated by network controls"
      expires: "2024-03-01"
  
  # Permanent exemptions (requires justification)
  permanent:
    - rule: "hardcoded-password"
      file: "tests/test_data.py"
      reason: "Test data only, not used in production"

# Reporting configuration
reporting:
  # Report formats
  formats:
    - sarif
    - json
    - html
    - pdf
  
  # Report distribution
  distribution:
    - github_security_tab
    - artifacts
    - s3_bucket
  
  # Retention policy
  retention_days: 90