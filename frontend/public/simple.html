<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namespace Controller - Test DynamoDB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #fafafa;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #34495e;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        button.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }

        .status.success {
            background: #d5f4e6;
            color: #27ae60;
            border: 2px solid #27ae60;
        }

        .status.error {
            background: #fdeaea;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }

        .status.info {
            background: #ebf3fd;
            color: #3498db;
            border: 2px solid #3498db;
        }

        .schedules-list {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .schedule-item {
            padding: 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item:last-child {
            border-bottom: none;
        }

        .schedule-info h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .schedule-info p {
            color: #7f8c8d;
            margin: 2px 0;
        }

        .schedule-actions button {
            padding: 8px 16px;
            font-size: 14px;
            margin-left: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Namespace Controller</h1>
            <p>Sistema de Apagado Autom√°tico - Test DynamoDB</p>
        </div>

        <div class="content">
            <!-- Status del Sistema -->
            <div class="section">
                <h2>üìä Estado del Sistema</h2>
                <div id="system-status" class="status info">
                    <div class="spinner"></div>
                    Verificando conexi√≥n con DynamoDB...
                </div>
                <button onclick="checkSystemHealth()">üîÑ Verificar Estado</button>
            </div>

            <div class="grid">
                <!-- Crear Schedule -->
                <div class="section">
                    <h2>‚ûï Crear Schedule</h2>
                    <form id="create-schedule-form">
                        <div class="form-group">
                            <label for="namespace">Namespace:</label>
                            <input type="text" id="namespace" name="namespace" required 
                                   placeholder="ej: production-app">
                        </div>
                        
                        <div class="form-group">
                            <label for="startup-time">Hora de Inicio:</label>
                            <input type="time" id="startup-time" name="startup_time" required value="08:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="shutdown-time">Hora de Apagado:</label>
                            <input type="time" id="shutdown-time" name="shutdown_time" required value="18:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="timezone">Zona Horaria:</label>
                            <select id="timezone" name="timezone" required>
                                <option value="America/Bogota">America/Bogota</option>
                                <option value="America/New_York">America/New_York</option>
                                <option value="Europe/Madrid">Europe/Madrid</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="business-unit">Unidad de Negocio:</label>
                            <input type="text" id="business-unit" name="business_unit" 
                                   placeholder="ej: Engineering">
                        </div>
                        
                        <button type="submit" class="success">üíæ Crear Schedule</button>
                    </form>
                </div>

                <!-- Leer Schedules -->
                <div class="section">
                    <h2>üìã Schedules Existentes</h2>
                    <button onclick="loadSchedules()" class="success">üîÑ Cargar Schedules</button>
                    <button onclick="clearSchedules()" class="danger">üóëÔ∏è Limpiar Lista</button>
                    
                    <div id="schedules-container">
                        <div class="loading">
                            <p>Haz clic en "Cargar Schedules" para ver los datos</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs de Operaciones -->
            <div class="section">
                <h2>üìù Log de Operaciones</h2>
                <button onclick="clearLogs()" class="danger">üóëÔ∏è Limpiar Logs</button>
                <div id="operation-logs" style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; font-family: monospace; max-height: 300px; overflow-y: auto; margin-top: 10px;">
                    <p>üöÄ Sistema iniciado - Listo para probar DynamoDB</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de la API
        const API_BASE_URL = '/api';
        
        // Funci√≥n para agregar logs
        function addLog(message, type = 'info') {
            const logs = document.getElementById('operation-logs');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logs.innerHTML += `\n[${timestamp}] ${emoji} ${message}`;
            logs.scrollTop = logs.scrollHeight;
        }

        // Funci√≥n para limpiar logs
        function clearLogs() {
            document.getElementById('operation-logs').innerHTML = '<p>üöÄ Sistema iniciado - Listo para probar DynamoDB</p>';
        }

        // Funci√≥n para verificar el estado del sistema
        async function checkSystemHealth() {
            const statusDiv = document.getElementById('system-status');
            statusDiv.className = 'status info';
            statusDiv.innerHTML = '<div class="spinner"></div>Verificando conexi√≥n...';
            
            addLog('Verificando estado del sistema...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = `
                        ‚úÖ Sistema Saludable<br>
                        üîó DynamoDB: ${data.components?.dynamodb ? 'Conectado' : 'Desconectado'}<br>
                        ‚öôÔ∏è Controller: ${data.components?.controller ? 'Activo' : 'Inactivo'}<br>
                        üìÖ √öltima verificaci√≥n: ${new Date().toLocaleString()}
                    `;
                    addLog('Estado del sistema verificado correctamente', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${data.message || 'Error desconocido'}`);
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
                addLog(`Error al verificar estado: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para crear un schedule
        document.getElementById('create-schedule-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const scheduleData = {
                namespace: formData.get('namespace'),
                startup_time: formData.get('startup_time'),
                shutdown_time: formData.get('shutdown_time'),
                timezone: formData.get('timezone'),
                days_of_week: ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'],
                enabled: true,
                metadata: {
                    business_unit: formData.get('business_unit') || 'Default',
                    cost_savings_target: 1000
                }
            };

            addLog(`Creando schedule para namespace: ${scheduleData.namespace}`);

            try {
                const response = await fetch(`${API_BASE_URL}/schedules`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(scheduleData)
                });

                const result = await response.json();

                if (response.ok) {
                    addLog(`‚úÖ Schedule creado exitosamente: ${result.id}`, 'success');
                    e.target.reset();
                    // Recargar la lista de schedules
                    loadSchedules();
                } else {
                    throw new Error(`HTTP ${response.status}: ${result.message || 'Error al crear schedule'}`);
                }
            } catch (error) {
                addLog(`‚ùå Error al crear schedule: ${error.message}`, 'error');
            }
        });

        // Funci√≥n para cargar schedules
        async function loadSchedules() {
            const container = document.getElementById('schedules-container');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Cargando schedules...</p></div>';
            
            addLog('Cargando schedules desde DynamoDB...');

            try {
                const response = await fetch(`${API_BASE_URL}/schedules`);
                const schedules = await response.json();

                if (response.ok) {
                    if (schedules.length === 0) {
                        container.innerHTML = '<div class="status info">üì≠ No hay schedules configurados</div>';
                        addLog('No se encontraron schedules');
                    } else {
                        let html = '<div class="schedules-list">';
                        schedules.forEach(schedule => {
                            html += `
                                <div class="schedule-item">
                                    <div class="schedule-info">
                                        <h3>üè∑Ô∏è ${schedule.namespace}</h3>
                                        <p>‚è∞ ${schedule.startup_time} - ${schedule.shutdown_time}</p>
                                        <p>üåç ${schedule.timezone}</p>
                                        <p>üè¢ ${schedule.metadata?.business_unit || 'N/A'}</p>
                                        <p>üí∞ Ahorro objetivo: $${schedule.metadata?.cost_savings_target || 0}/mes</p>
                                        <p>üìÖ Creado: ${new Date(schedule.created_at).toLocaleString()}</p>
                                    </div>
                                    <div class="schedule-actions">
                                        <button onclick="deleteSchedule('${schedule.id}')" class="danger">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        container.innerHTML = html;
                        addLog(`‚úÖ Cargados ${schedules.length} schedules`, 'success');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${schedules.message || 'Error al cargar schedules'}`);
                }
            } catch (error) {
                container.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                addLog(`‚ùå Error al cargar schedules: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para eliminar un schedule
        async function deleteSchedule(scheduleId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este schedule?')) {
                return;
            }

            addLog(`Eliminando schedule: ${scheduleId}`);

            try {
                const response = await fetch(`${API_BASE_URL}/schedules/${scheduleId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    addLog(`‚úÖ Schedule eliminado: ${scheduleId}`, 'success');
                    loadSchedules(); // Recargar la lista
                } else {
                    const error = await response.json();
                    throw new Error(`HTTP ${response.status}: ${error.message || 'Error al eliminar'}`);
                }
            } catch (error) {
                addLog(`‚ùå Error al eliminar schedule: ${error.message}`, 'error');
            }
        }

        // Funci√≥n para limpiar la lista de schedules
        function clearSchedules() {
            document.getElementById('schedules-container').innerHTML = '<div class="loading"><p>Haz clic en "Cargar Schedules" para ver los datos</p></div>';
            addLog('Lista de schedules limpiada');
        }

        // Verificar estado del sistema al cargar la p√°gina
        window.addEventListener('load', () => {
            addLog('üåü Frontend b√°sico cargado correctamente');
            setTimeout(checkSystemHealth, 1000);
        });
    </script>
</body>
</html>