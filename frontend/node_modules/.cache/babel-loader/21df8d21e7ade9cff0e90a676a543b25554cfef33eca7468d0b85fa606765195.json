{"ast":null,"code":"import _objectSpread from\"/home/diediazping/Documents/apagado-automatico/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useRef,useState,useCallback}from'react';export const useWebSocket=options=>{const{url,reconnectAttempts=5,reconnectInterval=3000,onMessage,onConnect,onDisconnect,onError}=options;const[state,setState]=useState({connected:false,connecting:false,error:null,last_message:null,reconnect_attempts:0,max_reconnect_attempts:reconnectAttempts});const wsRef=useRef(null);const reconnectTimeoutRef=useRef(null);const mountedRef=useRef(true);const connect=useCallback(()=>{if(!mountedRef.current)return;setState(prev=>_objectSpread(_objectSpread({},prev),{},{connecting:true,error:null}));try{const ws=new WebSocket(url);wsRef.current=ws;ws.onopen=()=>{if(!mountedRef.current)return;setState(prev=>_objectSpread(_objectSpread({},prev),{},{connected:true,connecting:false,error:null,reconnect_attempts:0}));onConnect===null||onConnect===void 0?void 0:onConnect();};ws.onmessage=event=>{if(!mountedRef.current)return;try{const message=JSON.parse(event.data);setState(prev=>_objectSpread(_objectSpread({},prev),{},{last_message:message}));onMessage===null||onMessage===void 0?void 0:onMessage(message);}catch(error){console.error('Failed to parse WebSocket message:',error);}};ws.onclose=()=>{if(!mountedRef.current)return;setState(prev=>_objectSpread(_objectSpread({},prev),{},{connected:false,connecting:false}));onDisconnect===null||onDisconnect===void 0?void 0:onDisconnect();// Attempt reconnection if we haven't exceeded max attempts\nif(state.reconnect_attempts<reconnectAttempts){reconnectTimeoutRef.current=setTimeout(()=>{if(mountedRef.current){setState(prev=>_objectSpread(_objectSpread({},prev),{},{reconnect_attempts:prev.reconnect_attempts+1}));connect();}},reconnectInterval);}};ws.onerror=error=>{if(!mountedRef.current)return;setState(prev=>_objectSpread(_objectSpread({},prev),{},{connected:false,connecting:false,error:'WebSocket connection error'}));onError===null||onError===void 0?void 0:onError(error);};}catch(error){setState(prev=>_objectSpread(_objectSpread({},prev),{},{connected:false,connecting:false,error:'Failed to create WebSocket connection'}));}},[url,reconnectAttempts,reconnectInterval,onMessage,onConnect,onDisconnect,onError,state.reconnect_attempts]);const disconnect=useCallback(()=>{if(reconnectTimeoutRef.current){clearTimeout(reconnectTimeoutRef.current);reconnectTimeoutRef.current=null;}if(wsRef.current){wsRef.current.close();wsRef.current=null;}setState(prev=>_objectSpread(_objectSpread({},prev),{},{connected:false,connecting:false,reconnect_attempts:0}));},[]);const sendMessage=useCallback(message=>{if(wsRef.current&&state.connected){try{wsRef.current.send(JSON.stringify(message));return true;}catch(error){console.error('Failed to send WebSocket message:',error);return false;}}return false;},[state.connected]);// Connect on mount\nuseEffect(()=>{connect();return()=>{mountedRef.current=false;disconnect();};},[connect,disconnect]);// Cleanup on unmount\nuseEffect(()=>{return()=>{mountedRef.current=false;if(reconnectTimeoutRef.current){clearTimeout(reconnectTimeoutRef.current);}};},[]);return _objectSpread(_objectSpread({},state),{},{connect,disconnect,sendMessage});};","map":{"version":3,"names":["useEffect","useRef","useState","useCallback","useWebSocket","options","url","reconnectAttempts","reconnectInterval","onMessage","onConnect","onDisconnect","onError","state","setState","connected","connecting","error","last_message","reconnect_attempts","max_reconnect_attempts","wsRef","reconnectTimeoutRef","mountedRef","connect","current","prev","_objectSpread","ws","WebSocket","onopen","onmessage","event","message","JSON","parse","data","console","onclose","setTimeout","onerror","disconnect","clearTimeout","close","sendMessage","send","stringify"],"sources":["/home/diediazping/Documents/apagado-automatico/frontend/src/hooks/useWebSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\nimport { WebSocketMessage, WebSocketState } from '../types';\n\ninterface UseWebSocketOptions {\n  url: string;\n  reconnectAttempts?: number;\n  reconnectInterval?: number;\n  onMessage?: (message: WebSocketMessage) => void;\n  onConnect?: () => void;\n  onDisconnect?: () => void;\n  onError?: (error: Event) => void;\n}\n\nexport const useWebSocket = (options: UseWebSocketOptions) => {\n  const {\n    url,\n    reconnectAttempts = 5,\n    reconnectInterval = 3000,\n    onMessage,\n    onConnect,\n    onDisconnect,\n    onError\n  } = options;\n\n  const [state, setState] = useState<WebSocketState>({\n    connected: false,\n    connecting: false,\n    error: null,\n    last_message: null,\n    reconnect_attempts: 0,\n    max_reconnect_attempts: reconnectAttempts\n  });\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const mountedRef = useRef(true);\n\n  const connect = useCallback(() => {\n    if (!mountedRef.current) return;\n\n    setState(prev => ({ ...prev, connecting: true, error: null }));\n\n    try {\n      const ws = new WebSocket(url);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        if (!mountedRef.current) return;\n        \n        setState(prev => ({\n          ...prev,\n          connected: true,\n          connecting: false,\n          error: null,\n          reconnect_attempts: 0\n        }));\n        \n        onConnect?.();\n      };\n\n      ws.onmessage = (event) => {\n        if (!mountedRef.current) return;\n\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          setState(prev => ({ ...prev, last_message: message }));\n          onMessage?.(message);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n\n      ws.onclose = () => {\n        if (!mountedRef.current) return;\n\n        setState(prev => ({ ...prev, connected: false, connecting: false }));\n        onDisconnect?.();\n\n        // Attempt reconnection if we haven't exceeded max attempts\n        if (state.reconnect_attempts < reconnectAttempts) {\n          reconnectTimeoutRef.current = setTimeout(() => {\n            if (mountedRef.current) {\n              setState(prev => ({ \n                ...prev, \n                reconnect_attempts: prev.reconnect_attempts + 1 \n              }));\n              connect();\n            }\n          }, reconnectInterval);\n        }\n      };\n\n      ws.onerror = (error) => {\n        if (!mountedRef.current) return;\n\n        setState(prev => ({\n          ...prev,\n          connected: false,\n          connecting: false,\n          error: 'WebSocket connection error'\n        }));\n        \n        onError?.(error);\n      };\n\n    } catch (error) {\n      setState(prev => ({\n        ...prev,\n        connected: false,\n        connecting: false,\n        error: 'Failed to create WebSocket connection'\n      }));\n    }\n  }, [url, reconnectAttempts, reconnectInterval, onMessage, onConnect, onDisconnect, onError, state.reconnect_attempts]);\n\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = null;\n    }\n\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    setState(prev => ({\n      ...prev,\n      connected: false,\n      connecting: false,\n      reconnect_attempts: 0\n    }));\n  }, []);\n\n  const sendMessage = useCallback((message: any) => {\n    if (wsRef.current && state.connected) {\n      try {\n        wsRef.current.send(JSON.stringify(message));\n        return true;\n      } catch (error) {\n        console.error('Failed to send WebSocket message:', error);\n        return false;\n      }\n    }\n    return false;\n  }, [state.connected]);\n\n  // Connect on mount\n  useEffect(() => {\n    connect();\n\n    return () => {\n      mountedRef.current = false;\n      disconnect();\n    };\n  }, [connect, disconnect]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      mountedRef.current = false;\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    ...state,\n    connect,\n    disconnect,\n    sendMessage\n  };\n};"],"mappings":"4IAAA,OAASA,SAAS,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CAahE,MAAO,MAAM,CAAAC,YAAY,CAAIC,OAA4B,EAAK,CAC5D,KAAM,CACJC,GAAG,CACHC,iBAAiB,CAAG,CAAC,CACrBC,iBAAiB,CAAG,IAAI,CACxBC,SAAS,CACTC,SAAS,CACTC,YAAY,CACZC,OACF,CAAC,CAAGP,OAAO,CAEX,KAAM,CAACQ,KAAK,CAAEC,QAAQ,CAAC,CAAGZ,QAAQ,CAAiB,CACjDa,SAAS,CAAE,KAAK,CAChBC,UAAU,CAAE,KAAK,CACjBC,KAAK,CAAE,IAAI,CACXC,YAAY,CAAE,IAAI,CAClBC,kBAAkB,CAAE,CAAC,CACrBC,sBAAsB,CAAEb,iBAC1B,CAAC,CAAC,CAEF,KAAM,CAAAc,KAAK,CAAGpB,MAAM,CAAmB,IAAI,CAAC,CAC5C,KAAM,CAAAqB,mBAAmB,CAAGrB,MAAM,CAAwB,IAAI,CAAC,CAC/D,KAAM,CAAAsB,UAAU,CAAGtB,MAAM,CAAC,IAAI,CAAC,CAE/B,KAAM,CAAAuB,OAAO,CAAGrB,WAAW,CAAC,IAAM,CAChC,GAAI,CAACoB,UAAU,CAACE,OAAO,CAAE,OAEzBX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEV,UAAU,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAI,EAAG,CAAC,CAE9D,GAAI,CACF,KAAM,CAAAW,EAAE,CAAG,GAAI,CAAAC,SAAS,CAACvB,GAAG,CAAC,CAC7Be,KAAK,CAACI,OAAO,CAAGG,EAAE,CAElBA,EAAE,CAACE,MAAM,CAAG,IAAM,CAChB,GAAI,CAACP,UAAU,CAACE,OAAO,CAAE,OAEzBX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACRD,IAAI,MACPX,SAAS,CAAE,IAAI,CACfC,UAAU,CAAE,KAAK,CACjBC,KAAK,CAAE,IAAI,CACXE,kBAAkB,CAAE,CAAC,EACrB,CAAC,CAEHT,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAG,CAAC,CACf,CAAC,CAEDkB,EAAE,CAACG,SAAS,CAAIC,KAAK,EAAK,CACxB,GAAI,CAACT,UAAU,CAACE,OAAO,CAAE,OAEzB,GAAI,CACF,KAAM,CAAAQ,OAAyB,CAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC,CACxDtB,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAER,YAAY,CAAEe,OAAO,EAAG,CAAC,CACtDxB,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAGwB,OAAO,CAAC,CACtB,CAAE,MAAOhB,KAAK,CAAE,CACdoB,OAAO,CAACpB,KAAK,CAAC,oCAAoC,CAAEA,KAAK,CAAC,CAC5D,CACF,CAAC,CAEDW,EAAE,CAACU,OAAO,CAAG,IAAM,CACjB,GAAI,CAACf,UAAU,CAACE,OAAO,CAAE,OAEzBX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEX,SAAS,CAAE,KAAK,CAAEC,UAAU,CAAE,KAAK,EAAG,CAAC,CACpEL,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAG,CAAC,CAEhB;AACA,GAAIE,KAAK,CAACM,kBAAkB,CAAGZ,iBAAiB,CAAE,CAChDe,mBAAmB,CAACG,OAAO,CAAGc,UAAU,CAAC,IAAM,CAC7C,GAAIhB,UAAU,CAACE,OAAO,CAAE,CACtBX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACRD,IAAI,MACPP,kBAAkB,CAAEO,IAAI,CAACP,kBAAkB,CAAG,CAAC,EAC/C,CAAC,CACHK,OAAO,CAAC,CAAC,CACX,CACF,CAAC,CAAEhB,iBAAiB,CAAC,CACvB,CACF,CAAC,CAEDoB,EAAE,CAACY,OAAO,CAAIvB,KAAK,EAAK,CACtB,GAAI,CAACM,UAAU,CAACE,OAAO,CAAE,OAEzBX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACRD,IAAI,MACPX,SAAS,CAAE,KAAK,CAChBC,UAAU,CAAE,KAAK,CACjBC,KAAK,CAAE,4BAA4B,EACnC,CAAC,CAEHL,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAGK,KAAK,CAAC,CAClB,CAAC,CAEH,CAAE,MAAOA,KAAK,CAAE,CACdH,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACRD,IAAI,MACPX,SAAS,CAAE,KAAK,CAChBC,UAAU,CAAE,KAAK,CACjBC,KAAK,CAAE,uCAAuC,EAC9C,CAAC,CACL,CACF,CAAC,CAAE,CAACX,GAAG,CAAEC,iBAAiB,CAAEC,iBAAiB,CAAEC,SAAS,CAAEC,SAAS,CAAEC,YAAY,CAAEC,OAAO,CAAEC,KAAK,CAACM,kBAAkB,CAAC,CAAC,CAEtH,KAAM,CAAAsB,UAAU,CAAGtC,WAAW,CAAC,IAAM,CACnC,GAAImB,mBAAmB,CAACG,OAAO,CAAE,CAC/BiB,YAAY,CAACpB,mBAAmB,CAACG,OAAO,CAAC,CACzCH,mBAAmB,CAACG,OAAO,CAAG,IAAI,CACpC,CAEA,GAAIJ,KAAK,CAACI,OAAO,CAAE,CACjBJ,KAAK,CAACI,OAAO,CAACkB,KAAK,CAAC,CAAC,CACrBtB,KAAK,CAACI,OAAO,CAAG,IAAI,CACtB,CAEAX,QAAQ,CAACY,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACRD,IAAI,MACPX,SAAS,CAAE,KAAK,CAChBC,UAAU,CAAE,KAAK,CACjBG,kBAAkB,CAAE,CAAC,EACrB,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAyB,WAAW,CAAGzC,WAAW,CAAE8B,OAAY,EAAK,CAChD,GAAIZ,KAAK,CAACI,OAAO,EAAIZ,KAAK,CAACE,SAAS,CAAE,CACpC,GAAI,CACFM,KAAK,CAACI,OAAO,CAACoB,IAAI,CAACX,IAAI,CAACY,SAAS,CAACb,OAAO,CAAC,CAAC,CAC3C,MAAO,KAAI,CACb,CAAE,MAAOhB,KAAK,CAAE,CACdoB,OAAO,CAACpB,KAAK,CAAC,mCAAmC,CAAEA,KAAK,CAAC,CACzD,MAAO,MAAK,CACd,CACF,CACA,MAAO,MAAK,CACd,CAAC,CAAE,CAACJ,KAAK,CAACE,SAAS,CAAC,CAAC,CAErB;AACAf,SAAS,CAAC,IAAM,CACdwB,OAAO,CAAC,CAAC,CAET,MAAO,IAAM,CACXD,UAAU,CAACE,OAAO,CAAG,KAAK,CAC1BgB,UAAU,CAAC,CAAC,CACd,CAAC,CACH,CAAC,CAAE,CAACjB,OAAO,CAAEiB,UAAU,CAAC,CAAC,CAEzB;AACAzC,SAAS,CAAC,IAAM,CACd,MAAO,IAAM,CACXuB,UAAU,CAACE,OAAO,CAAG,KAAK,CAC1B,GAAIH,mBAAmB,CAACG,OAAO,CAAE,CAC/BiB,YAAY,CAACpB,mBAAmB,CAACG,OAAO,CAAC,CAC3C,CACF,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,OAAAE,aAAA,CAAAA,aAAA,IACKd,KAAK,MACRW,OAAO,CACPiB,UAAU,CACVG,WAAW,GAEf,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}