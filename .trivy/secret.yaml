# Trivy secret scanning configuration
# This file defines custom secret detection rules and patterns

# Custom secret detection rules
rules:
  # AWS credentials
  - id: aws-access-key
    category: aws
    title: AWS Access Key ID
    severity: CRITICAL
    regex: 'AKIA[0-9A-Z]{16}'
    keywords:
      - aws_access_key_id
      - aws-access-key-id
      - AKIA
    
  - id: aws-secret-key
    category: aws
    title: AWS Secret Access Key
    severity: CRITICAL
    regex: '[A-Za-z0-9/+=]{40}'
    keywords:
      - aws_secret_access_key
      - aws-secret-access-key
    
  # Database credentials
  - id: database-password
    category: database
    title: Database Password
    severity: HIGH
    regex: '(?i)(password|passwd|pwd)\s*[:=]\s*["\']?[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};:,.<>?]{8,}["\']?'
    keywords:
      - password
      - passwd
      - pwd
      - db_password
      - database_password
    
  # API keys and tokens
  - id: generic-api-key
    category: api
    title: Generic API Key
    severity: HIGH
    regex: '(?i)(api[_-]?key|apikey|token)\s*[:=]\s*["\']?[a-zA-Z0-9]{20,}["\']?'
    keywords:
      - api_key
      - apikey
      - api-key
      - token
      - access_token
    
  # Private keys
  - id: private-key
    category: crypto
    title: Private Key
    severity: CRITICAL
    regex: '-----BEGIN [A-Z]+ PRIVATE KEY-----'
    keywords:
      - private_key
      - private-key
      - BEGIN PRIVATE KEY
      - BEGIN RSA PRIVATE KEY
      - BEGIN EC PRIVATE KEY
    
  # JWT tokens
  - id: jwt-token
    category: auth
    title: JWT Token
    severity: MEDIUM
    regex: 'eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*'
    keywords:
      - jwt
      - bearer
      - authorization
    
  # Kubernetes secrets
  - id: k8s-secret
    category: kubernetes
    title: Kubernetes Secret
    severity: HIGH
    regex: '(?i)(secret|token)\s*[:=]\s*["\']?[a-zA-Z0-9+/]{20,}={0,2}["\']?'
    keywords:
      - kubernetes
      - k8s
      - secret
      - serviceaccount
    
  # Docker registry credentials
  - id: docker-auth
    category: docker
    title: Docker Registry Auth
    severity: HIGH
    regex: '(?i)(docker[_-]?auth|registry[_-]?auth)\s*[:=]\s*["\']?[a-zA-Z0-9+/]{20,}={0,2}["\']?'
    keywords:
      - docker_auth
      - registry_auth
      - dockerconfigjson
    
  # GitHub tokens
  - id: github-token
    category: github
    title: GitHub Token
    severity: HIGH
    regex: 'gh[pousr]_[A-Za-z0-9_]{36,255}'
    keywords:
      - github_token
      - github-token
      - ghp_
      - gho_
      - ghu_
      - ghs_
      - ghr_

# Global settings for secret scanning
global:
  # Minimum entropy for generic secrets
  min-entropy: 3.5
  
  # Maximum line length to scan
  max-line-length: 1000
  
  # File size limit (in bytes)
  max-file-size: 1048576  # 1MB
  
  # Exclude patterns
  exclude-patterns:
    - '\.git/'
    - 'node_modules/'
    - 'build/'
    - 'dist/'
    - 'coverage/'
    - '\.pytest_cache/'
    - '__pycache__/'
    - '\.mypy_cache/'
    - '\.vscode/'
    - '\.idea/'
    - '\.DS_Store'
    - '\.log$'
    - '\.tmp$'
    - '\.cache$'
  
  # Include only specific file types
  include-patterns:
    - '\.py$'
    - '\.js$'
    - '\.ts$'
    - '\.jsx$'
    - '\.tsx$'
    - '\.yaml$'
    - '\.yml$'
    - '\.json$'
    - '\.env$'
    - '\.env\.'
    - 'Dockerfile'
    - '\.sh$'
    - '\.bash$'
    - '\.zsh$'
    - '\.fish$'
    - '\.tf$'
    - '\.hcl$'
    - '\.toml$'
    - '\.ini$'
    - '\.cfg$'
    - '\.conf$'
    - '\.properties$'

# Allowlist for known false positives
allowlist:
  # Test files and examples
  paths:
    - "tests/"
    - "test/"
    - "__tests__/"
    - "examples/"
    - "docs/"
    - "README.md"
    - "*.test.py"
    - "*.test.js"
    - "*.test.ts"
    - "test_*.py"
  
  # Known safe patterns
  secrets:
    - "password: 'test'"
    - "password: \"test\""
    - "password: test"
    - "token: 'dummy'"
    - "token: \"dummy\""
    - "api_key: 'example'"
    - "api_key: \"example\""
    - "secret: 'placeholder'"
    - "secret: \"placeholder\""
  
  # Entropy-based allowlist
  entropy:
    - "abcdefghijklmnopqrstuvwxyz"  # Alphabet
    - "1234567890"                  # Numbers
    - "ABCDEFGHIJKLMNOPQRSTUVWXYZ"  # Uppercase alphabet

# Custom keywords to enhance detection
keywords:
  high-priority:
    - password
    - secret
    - token
    - key
    - auth
    - credential
    - private
    - confidential
  
  medium-priority:
    - config
    - settings
    - env
    - var
    - param
    - option
  
  low-priority:
    - value
    - data
    - info
    - content